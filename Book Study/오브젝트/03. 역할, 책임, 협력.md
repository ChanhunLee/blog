## 역할, 책임, 협력


객체지향의 패러다임 관점에서의 핵심 : 역할(role), 책임(responsibility), 협력(collaboration)이다. 

#### 협력

  애플리케이션의 기능을 구현하기 위해  수행하는 상호 작용
- 영화 예매 시스템 돌아보기
  - 사용자가 영화 예매 시스템으로 예매 할 수 있으려면 다양한 객체들이 참여하는 협력을 구축해야 함
  - 제어 흐름은 하나의 객체에 통제되지 않고 객체들 사이에 균형 있게 분배되는 것이 일반적.
- 협력 
    - 메시지 전송(message sending)은 객체 사이의 협력을 위 사용할 수 있는 유일한 수단.
      - 메시지를 수신한 객체는 메서드를 실행에 요청에 응답
      - 외부 객체는 메시지만 전송, 어떻게 처리할지는 수신한 객체가 결정.
    - 예매 요금 계산 : Screening과 Movie 협력
      - Screening은 Movie에게calculateMovieFee 메시지 전송
      - Movie가 요금계산에 필요한 정보를 알고 있기때문에 요청.
      - Screening이 계산작업을 할경우 Movie의 내부 구현에 결합되고 Movie의 자율성 회손.
      - 객체를 자율적으로 만드는 기본적인 방법은 캡슐화
    - 협력이 설계를 위한 문맥을 결정한다. 
      - 객체의 행동을 결정하는 것은 객체가 참여하고 있는 협력.
      - Movie 대부분의 메소드는 요금을 계산하는 행동과 관련되어 있으며 예매를 위한 협력의 요금계산을 책임 지고 있다.
      - 객체의 상태를 결정하는 것은 행동, 객체는 자율적이기 때문에 행동에 필요한 상태도 가지고 있어야 한다.
      - 협력은 객체를 설계하는 데 필요한 일종의 문맥(context)을 제공한다.
  
#### 책임
-  책임이란 무엇인가
  - 협력에 참여하기 위해 객체가 수행하는 행동을 책임이라 한다. 
  - 하는 것(doing)
    - 객체를 생성하거나 계싼을 수행하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
  - 아는 것(knowing)
    - 사적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것
  - 객체에게 적절한 책임을 할당하는 것이 설계의 전체적인 품질을 결정한다. 
- 책임 할당
  - 정보  전문가(Information Expert) 패턴: 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에 할당.
  - 영화 예매 시스템의 책임 할당 방법
    1. `예매하라` 라는 이름의 메시지로 협력시작
    2. 예매 정보를 알고 소유하고 있는 Screening에게 책임 할당
    3. Screening이 외부객체에게 `가격을 계산하라` 메세지로 요청.
    4. Movie에게 가격계산에 대한 책임 할당
    5. Movie는 외부객체에 `할인요금을 계산하라` 라는 메세지로 요청
  - 결정된 메시지가 퍼블릭 인터페이스를 구성한다. 
  - 어떤 경우는 응집도와 결합도의 관점에서 정보 전문가가 아니라 다른 객체에 할당하는 것이 적절한 경우도 있음
- 책임 주도 설계(Responsibility-Driven Design, RDD)
  - 책임을 찾고 책임을 수행할 적절한 객체를 찾아 책임을 할당하는 방식으로 협력을 설계하는 방법
    - 시스템이 사용자에게 제공해야 하는 기능인 시스템 책임을 파악한다.
    - 시스템 책임을 더 작은 책임으로 분할한다.
    - 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
    - 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
    - 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 된디.
  - 메시지가 객체를 결정한다.
    - 객체가 최소한의 인터페이스(minimal interface)를 가질 수 있게 된다.
    - 객체는 충분히 추상적인 인터페이스(abstract interface)를 가질 수 있다.
  - 행동이 상태를 결정한다.
    - 객체를 객체답게 만드는 것은 상태가 아니라 다른 객체에게 제공하는 행동.
    - 초급자의 실수는 객체의 행동이 아니라 상태에 초점을 맞추는 것.
      - 이러한 방식은 캡슐화를 저해한다. 
      - 내부 구현에 초점을 맞춘 설계방법을 데이터 주도설계(Data-Driven Design) 이라 한다.
    - 개별 객체의 상태와 행동이 아닌 시스템 기능 구현을 위한 협력에 초점을 맞춰야 응집도가 높고 결합도가 낮은 객체들을 창조 할 수 있다. 

#### 역할 

- 역할과 협력
  - 어떤 특정한 협력 안에서 수행하는 책임의 집합을 역할 이라 한다.
    - 실제로 협력 모델링시 객체가 아니라 역할에게 책임을 할당한다고 생각하라.
  - 영화 예매에서 예매하라는 메시지를 처리하기에 적합한 객체로 Screening을 선택한 과정
    1. 영화를 예매할 수 있는 적절한 역할이 무엇인가.
    2. 역할을 수행할 객체로 Screening 인스턴스를 선택
  - 역할에 이름을 부여하진 않았지만 실제로는 익명의 역할을 찾고 그 역할을 수행할 수 있는 객체를 선택하는 방식
- 유연하고 재사용 가능한 협력
  - 역할의 중요한 이류는 유연하고 재사용 가능한 협력을 얻을 수 있기 때문이다.
  - 잘못된 예로 이해를 도와보자
    1. Movie가 가격을 계산을 위해 `할인 요금을 계산하라` 라는 메시지를 외부 객체에 요청
    2. 금액할인(Amount Discount Policy)과 비율할인(Percent Discount Policy) 두가지 종류의 할인 정책이 존재. 
        -  두 종류의 객체가 참여하는 협력을 개별적으로 만들어야 하나?
        - 이런 방법은 코드 중복이 발생.
      - 문제를 해결하기 위해서는 객체가 아님 책임에 초점.
      - 역할은 다른 것으로 교체할 수 있는 책임의 집합.
      - 역할이 두 종류의 객체를 포괄하는 추상화이다. 
    3. Discount Policy 라는 추상적인 역할을 이용하여 두개의 협력을 하나로 통합.
        -  역할로 인해 협력이 유연해지고 변경과 확장이 용이 해짐
    4. None Discount Policy도 DiscountPolicy 역할을 수행하는 객체의 한 종류이기 때문에 동일한 협력 방식을 재사용 할 수 있다. 
   
- 객체 대 역할
  - 역할은 객체가 참여할 수 있는 일종의 슬롯이다.
  - 협력에 참여하는 후보가 여러 종류의 객체에 의해 수행될 필요가 있다면 그 후보는 역할이 되지만 단지 한 종류의 객체만이 협력에 참여할 필요가 있다면 후보는 객체가 된다.
  - 다양한 객체들이 협력에 참여한다는 것이 확실하다면 역할로 시작하라. 하지만 정확한 결정을 내리기 어려운 상황이라면 구체적인 객체로 시작하라.
- 역할과 추상화
  - 추상화를 이용한 설계의 두가지 장점
    - 추상화 계층만을 이용하면 중요한 정책을 상위 수준에서 단수화 할 수 있다.
    - 설계가 좀더 유연해진다.
  - 협력의 관점에서 두가지 장점
    - 세부 사항에 억눌리지 않고도 상위 수준의 정책을 쉽고 간단하게 표현할 있다.
    - 설계를 유연하게 만들 수 있다. 
- 배우와 배역
  - 배우가 여러 연극에 참여하면서 여러 배역을 연기 할 수 이쓴 것처럼 객체 역시 여러 협력에 참여하면서 다양한 역할을 수행할 수 있다.
    - 특정한 협력 안에서는 일시적으로 오직 하나의 역할만이 보여진다는 점에 주의.
  - 객체는 다양한 역할을 가질 수 있다. 객체는 협력에 참여할 때 협력 안에서 하나의 역할로 보여진다. 
